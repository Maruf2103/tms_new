<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
{% extends 'base/base.html' %}
{% load crispy_forms_tags %}

{% block title %}Register for Bus - UAP TMS{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h2><i class="fas fa-clipboard-check"></i> Register for Bus</h2>
    </div>
</div>

<div class="card mb-4">
    <div class="card-header">
        <i class="fas fa-search"></i> Search Bus Schedule
    </div>
    <div class="card-body">
        <form method="get">
            <div class="row">
                <div class="col-md-5">
                    {{ search_form.route }}
                </div>
                <div class="col-md-5">
                    {{ search_form.shift }}
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<div class="row">
    {% for schedule in schedules %}
    <div class="col-md-6 mb-4">
        <div class="card h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">{{ schedule.bus.bus_number }} - {{ schedule.bus.bus_name }}</h5>
            </div>
            <div class="card-body">
                <p><strong><i class="fas fa-route"></i> Route:</strong> {{ schedule.route.route_name }}</p>
                <p><strong><i class="fas fa-map-marker-alt"></i> From:</strong> {{ schedule.route.start_point }}</p>
                <p><strong><i class="fas fa-map-marker-alt"></i> To:</strong> {{ schedule.route.end_point }}</p>
                <p><strong><i class="fas fa-clock"></i> Shift:</strong> {{ schedule.get_shift_display }}</p>
                <p><strong><i class="fas fa-hourglass-start"></i> Departure:</strong> {{ schedule.departure_time }}</p>
                <p><strong><i class="fas fa-hourglass-end"></i> Arrival:</strong> {{ schedule.arrival_time }}</p>
                <p><strong><i class="fas fa-calendar"></i> Days:</strong> {{ schedule.days_of_week }}</p>
                <p><strong><i class="fas fa-chair"></i> Available Seats:</strong>
                    <span class="badge bg-{% if schedule.available_seats > 0 %}success{% else %}danger{% endif %}">
                        {{ schedule.available_seats }} / {{ schedule.bus.capacity }}
                    </span>
                </p>
            </div>
            <div class="card-footer">
                {% if schedule.available_seats > 0 %}
                <a href="{% url 'registrations:confirm_registration' schedule.id %}" class="btn btn-success w-100">
                    <i class="fas fa-check"></i> Register Now
                </a>
                {% else %}
                <button class="btn btn-secondary w-100" disabled>
                    <i class="fas fa-ban"></i> Fully Booked
                </button>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="col-12">
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> No bus schedules found. Try different search criteria.
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}
</body>
</html>