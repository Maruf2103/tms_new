{% extends 'base/base.html' %} {% block title %}Live Tracking - UAP TMS{%
endblock %} {% block extra_css %}
<style>
  #map {
    height: 500px;
    width: 100%;
    border-radius: 10px;
  }
  .bus-marker {
    background-color: #3498db;
    color: white;
    padding: 5px 10px;
    border-radius: 5px;
    font-weight: bold;
  }
</style>
{% endblock %} {% block content %}
<div class="row mb-4">
  <div class="col-12">
    <h2><i class="fas fa-map-marker-alt"></i> Live Bus Tracking</h2>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header"><i class="fas fa-map"></i> Live Map</div>
  <div class="card-body">
    <div id="map"></div>
    <div class="alert alert-info mt-3">
      <i class="fas fa-info-circle"></i>
      <strong>Note:</strong> This is a demonstration map. In production,
      integrate with Google Maps API for real-time tracking. <br />To enable
      Google Maps: Get API key from
      <a href="https://console.cloud.google.com/" target="_blank"
        >Google Cloud Console</a
      >
      and add it to settings.
    </div>
  </div>
</div>

<div class="row">
  <div class="col-12">
    <h4 class="mb-3">Active Buses</h4>
  </div>

  {% for item in bus_locations %}
  <div class="col-md-4 mb-3">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">
          {{ item.bus.bus_number }} - {{ item.bus.bus_name }}
        </h5>
      </div>
      <div class="card-body">
        {% if item.location %}
        <p>
          <strong><i class="fas fa-map-pin"></i> Location:</strong> {{
          item.location.latitude }}, {{ item.location.longitude }}
        </p>
        <p>
          <strong><i class="fas fa-tachometer-alt"></i> Speed:</strong> {{
          item.location.speed|default:"N/A" }} km/h
        </p>
        <p>
          <strong><i class="fas fa-clock"></i> Last Update:</strong> {{
          item.location.timestamp|timesince }} ago
        </p>
        {% else %}
        <p class="text-muted">Location not available</p>
        {% endif %} {% if item.status %}
        <p>
          <strong><i class="fas fa-info-circle"></i> Status:</strong>
          <span
            class="badge bg-{% if item.status.status == 'on_route' %}success{% elif item.status.status == 'delayed' %}warning{% else %}danger{% endif %}"
          >
            {{ item.status.get_status_display }}
          </span>
        </p>
        {% if item.status.delay_minutes > 0 %}
        <p class="text-warning">
          <i class="fas fa-exclamation-triangle"></i> Delayed by {{
          item.status.delay_minutes }} minutes
        </p>
        {% endif %} {% endif %}
      </div>
      <div class="card-footer">
        <a
          href="{% url 'tracking:bus_tracking_detail' item.bus.id %}"
          class="btn btn-sm btn-primary"
        >
          <i class="fas fa-eye"></i> View Details
        </a>
      </div>
    </div>
  </div>
  {% empty %}
  <div class="col-12">
    <div class="alert alert-info">
      <i class="fas fa-info-circle"></i> No active buses with location data.
    </div>
  </div>
  {% endfor %}
</div>

<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <i class="fas fa-bell"></i> Recent Notifications
      </div>
      <div class="card-body">
        <a href="{% url 'tracking:notifications_list' %}" class="btn btn-info">
          <i class="fas fa-list"></i> View All Notifications
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  // Placeholder for map initialization
  // In production, replace with actual Google Maps API
  document.addEventListener("DOMContentLoaded", function () {
    const mapDiv = document.getElementById("map");
    mapDiv.innerHTML =
      '<div class="d-flex align-items-center justify-content-center h-100 bg-light"><div class="text-center"><i class="fas fa-map fa-5x text-secondary mb-3"></i><p class="text-muted">Map view will be displayed here with Google Maps API integration</p><p class="text-muted">Current bus locations will be shown as markers on the map</p></div></div>';
  });

  // Auto-refresh every 30 seconds
  setInterval(function () {
    location.reload();
  }, 30000);
</script>
{% endblock %}
